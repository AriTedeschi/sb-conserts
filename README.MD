# Consents API
Uma API para gerenciar consentimentos de usu√°rios para uso de dados.

## :clipboard: Estrutura do Projeto

### Camadas
- **Controller**: Respons√°vel por expor os endpoints da API (`ConsentApi` e `IConsentApi`).
- **Service**: Cont√©m a l√≥gica de neg√≥cios (`ConsentServiceImpl`).
- **Repository**: Interage com o banco de dados para persist√™ncia de dados (`ConsentRepository`).
- **Adapter**: Realiza convers√µes entre entidades e objetos de requisi√ß√£o/resposta.
- **Model**: Define as entidades do dom√≠nio (`Consent`).

### Endpoints
- **POST /consents**: Cria√ß√£o de um novo consentimento.
- **GET /consents/{id}**: Busca de um consentimento por ID.
- **GET /consents**: Pesquisa de consentimentos com filtros opcionais.
- **PUT /consents/{id}**: Altera√ß√£o de um consentimento existente.
- **DELETE /consents/{id}**: Revoga√ß√£o de um consentimento.

### Banco de Dados
- Utiliza PostgreSQL, configurado no `docker-compose.test.yml`.
- Scripts de inicializa√ß√£o:
    - `tables.sql`: Cria√ß√£o de tabelas.
    - `role.sh`: Configura√ß√£o de permiss√µes.

### :computer: Diagrama de Entidade-Relacionamento
```mermaid
erDiagram
    TB_CONSENT {
        String id PK
        String cpf
        Integer status_id FK
        Datetime created_at
        Datetime expires_at
        String additional_info
    }
    
    TB_ROLE {
        Integer id PK
        String code
    }
```


### üîß Build e Deploy
- **Docker**:
    - `Dockerfile`: Configura√ß√£o multi-stage para otimizar a imagem final.
    - `docker-compose.test.yml`: Configura√ß√£o para ambiente de teste.
- **Maven**:
    - Gerenciamento de depend√™ncias e build do projeto.

### Testes
- Testes unit√°rios `ConsentServiceTest` para validar a l√≥gica de neg√≥cios e estressar as entradas e sa√≠das dos m√©todos.
- Testes de integra√ß√£o (`ConsentIntegrationTest`) para validar os endpoints e cen√°rios de erro.

### Padr√µes de C√≥digo
- **Value Objects**: Uso de VOs para encapsular l√≥gica de valida√ß√£o e formata√ß√£o de CPFs, Datas e mais.
- **DTOs**: Uso de DTOs para transferir dados entre camadas.
- **Centraliza√ß√£o de Exce√ß√µes**: Uso de `@ControllerAdvice` para padronizar respostas de erro.
- **Pagina√ß√£o e Ordena√ß√£o**: Implementadas nos endpoints de pesquisa.
- **Valida√ß√£o**: Valida√ß√£o de campos com mensagens de erro detalhadas.

### Tratamento de Erros
Todos os `errorInfos` s√£o tratados usando a anota√ß√£o `@ControllerAdvice`. Isso permite um tratamento centralizado de exce√ß√µes em todos os controladores da aplica√ß√£o. O formato de resposta de erro √© consistente e acess√≠vel em mais de uma lingua, seguindo a [RFC 9457](https://www.rfc-editor.org/rfc/rfc9457.html).

### :hammer_and_wrench: Configura√ß√µes
- Vari√°veis de ambiente definidas no `.env` para facilitar a configura√ß√£o do banco de dados e do perfil Spring (`dev`). Para configurar crie um arquivo `.env` em `/docker` com o seguinte conte√∫do:
```bash
POSTGRES_IP=localhost:5432
POSTGRES_DB=consents
POSTGRES_SCHEAMA=?currentSchema=public
POSTGRES_USER=dbUser
POSTGRES_PASSWORD=mydbpass

SPRING_DATASOURCE_IP=localhost:5432
SPRING_DATASOURCE_DBNAME=consents
SPRING_DATASOURCE_SCHEAMA=?currentSchema=public
SPRING_DATASOURCE_USERNAME=dbUser
SPRING_DATASOURCE_PASSWORD=mydbpass
```

### üöÄ Swagger
- Documenta√ß√£o da API gerada automaticamente com **[Swagger-ui](http://localhost:8080/swagger-ui/index.html):**, acess√≠vel em `/swagger-ui.html`.